<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="../../Contents/js/bootstrap-step/bs-js-fun.css" rel="stylesheet" />
    <!-- 新 Bootstrap 核心 CSS 文件 -->
    <!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="../../Contents/js/bootstrap-step/brush.js"></script>
    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <style>
        .mtd {
            line-height: 40px;
            vertical-align: middle;
        }

        .modal-body {
            min-height: 300px;
        }
        h5{
            line-height:100px;
            background:rgba(128, 128, 128, 0.21);
            font-size:1.4em;
            font-weight:400;
            text-align:center;
        }
    </style>
</head>
<body>
  
    <div style="margin:100px auto;width:800px;height:600px;">
        <h5>流程节点管理</h5>
        <ul class="nav nav-pills nav-justified step step-arrow" id="aq_ul">
            <li class="active">
                <a>step1</a>
            </li>
            <li class="active">
                <a>step2</a>
            </li>
            <li>
                <a>step3</a>
            </li>
        </ul>
        <div style="position:relative;top:10px;">
            <input type="button" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModalNext" name="" value="点击" placeholder="暴击9999" />
        </div>
    </div>
    <div class="modal fade" id="myModalNext">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title">选项配置</h4><ul id="step" class="nav nav-pills nav-justified step step-progress">
                        <li class="active">
                            <a>步骤一<span class="caret"></span></a>
                        </li>
                        <!--
                           <li>
                               <a>步骤二<span class="caret"></span></a>
                           </li>
                          <li>
                               <a>步骤三<span class="caret"></span></a>
                           </li>
                           <li>
                               <a>步骤四<span class="caret"></span></a>
                           </li>
                           <li>
                               <a>步骤五<span class="caret"></span></a>
                           </li>
                           <li>
                               <a>步骤六<span class="caret"></span></a>
                           </li>-->
                    </ul>
                </div>
                <div class="modal-body">
                    <div class="container-fluid">
                        <div class="carousel slide" data-ride="carousel" data-interval="false" data-wrap="false">
                            <form method="post" name="aq_form" id="aq_form">
                                <div class="carousel-inner" id="carouselinner" role="listbox">
                                    <div class="item active">
                                        <p>步骤一</p>
                                        <div class="container">
                                            <div class="row mtd">
                                                <div class="col-xs-2">
                                                    设置节点
                                                </div>
                                                <div class="col-xs-4">
                                                    <input type="text" class="form-control" name="node" />
                                                </div>
                                            </div>
                                            <div class="row mtd">
                                                <div class="col-xs-2">
                                                    配置角色
                                                </div>
                                                <div class="col-xs-4">
                                                    <input type="text" class="form-control" name="role" />
                                                </div>
                                            </div>
                                            <div class="row mtd">
                                                <div class="col-xs-2">
                                                    节点顺序
                                                </div>
                                                <div class="col-xs-4">
                                                    <input type="text" class="form-control" name="sort" />
                                                </div>
                                            </div>
                                            <div class="row mtd custom-control">
                                                <button type="button" class=" btn btn-primary" onclick="viewload.submit()">保存</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!--<div class="item">
                                        <p>步骤二</p>
                                        <div class="col-xs-2">
                                            配置用户
                                        </div>
                                        <div class="col-xs-4">
                                            <input type="text" class="form-control" />
                                        </div>
                                        <div class=" col-xs-4">
                                            <button type="button" class=" btn btn-primary">保存</button>
                                        </div>
                                    </div>
                                    <div class="item">
                                        <p>步骤三</p>
                                    </div>
                                    <div class="item">
                                        <p>步骤四</p>
                                    </div>
                                    <div class="item">
                                        <p>步骤五</p>
                                    </div>
                                    <div class="item">
                                        <p>步骤六</p>
                                    </div>-->
                                </div>
                            </form>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default MN-pre">上一步</button>
                    <button type="button" class="btn btn-primary MN-next">下一步</button>

                    <button type="button" class="btn btn-default MN-add">添加</button>
                    <button type="button" class="btn btn-default MN-del">删除</button>

                    <button type="button" class="btn btn-default" onclick="viewload.submitAll()">保存全部</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function () {
             viewload = {
                init: function () {
                    viewload.loadData();
                },
            openModal: function () {

            },
            submitAll:function(){
                var form = $("#aq_form").serializeArray();
                console.log(form);
            },
            submit: function () {
                var form = $("#aq_form div.active input");
                var ary = form.serializeArray();
                console.log(ary);
            },
            addNode: function () {
                viewload.setTitleNode();
                viewload.setContentNode();
            },
            delNode: function (obj) {
                if ($(".carousel-inner .item").length == 1) {
                    return;
                }
                viewload.setactive();//
            },
            //去掉此项选中并将选中减一
            setactive: function ()
            {
                $("#myModalNext .step li").each(function () {
                    if ($(this).hasClass("active")) {
                        var $this_ = $($($("#myModalNext .step li.active"))[$("#myModalNext .step li.active").length - 1]);
                        $this_.prev().addClass("active");
                        $this_.remove();
                        //$this_.removeClass("active");
                    }
                })

                $(".carousel-inner .item").each(function () {
                    console.log($(this).html());
                    if ($(this).hasClass("active")) {
                        var $this = $($($(".carousel-inner  div.active"))[$(".carousel-inner  div.active").length - 1]);
                        $this.prev().addClass("active");
                        $this.remove();
                    }
                })
            },
            setTitleNode: function () {
                viewload.cancelTitleactive();//取消已选中
                var headhtml = "<li class=\'active\'><a>步骤一<span class=\'caret\'></span></a></li>";
                $("#myModalNext .step").append(headhtml);
            },
            setContentNode:function(){
                viewload.cancelContentactive();//取消已选中
                var html = "<div class=\'item active\'><p>步骤一</p><div class=\'container\'><div class=\'row mtd\'><div class=\'col-xs-2\'>设置节点</div><div class=\'col-xs-4\'><input type=\'text\'class=\'form-control\'name=\'node\'/></div></div><div class=\'row mtd\'><div class=\'col-xs-2\'>配置角色</div><div class=\'col-xs-4\'><input type=\'text\'class=\'form-control\'name=\'role\'/></div></div><div class=\'row mtd\'><div class=\'col-xs-2\'>节点顺序</div><div class=\'col-xs-4\'><input type=\'text\'class=\'form-control\'name=\'sort\'/></div></div><div class=\'row mtd custom-control\'><button type=\'button\'class=\' btn btn-primary\'onclick=\'viewload.submit()\'>保存</button></div></div></div>";//"<div class=\'item active\'><p>步骤二</p><div class=\'col-xs-2\'>配置用户</div><div class=\'col-xs-4\'><input type=\'text\'class=\'form-control\'/></div><div class=\' col-xs-4\'><button type=\'button\'class=\' btn btn-primary\'>保存</button></div></div>";
                $(".carousel-inner").append(html);
            },
            cancelTitleactive: function () {
                $("#myModalNext .step li.active").removeClass("active");
            },
            cancelContentactive:function(){
                $("#carouselinner div.active").removeClass("active");
            },
            loadData: function () {
                                                                                          
                var data = ["节点1", "节点2", "节点3", "节点4"];
                var html = "";
                for (var i = 0; i < data.length; i++) {
                    html+="<li class=\"active\"><a>" + data[i] +"</a></li>";
                }
                $("#aq_ul").html(html);
                $("#aq_ul li").eq(3).removeClass("active");
                $("#myModalNext .modal-footer button").each(function () {
                    $(this).click(function () {
                        if ($(this).hasClass("MN-next")) {
                            //$("#myModalNext .carousel").carousel('next');
                            //$("#myModalNext .step li.active").next().addClass("active");
                            var index = $("#myModalNext .step li.active").index();
                            console.log(index);
                            var $step_elementli = $("#myModalNext .step li");
                            var $currstep_element = $step_elementli.eq(index);
                            var $nextstep_element = $step_elementli.eq(index + 1);

                            var $carousel_elementli = $(".carousel-inner div.item");
                            var $curr_element = $carousel_elementli.eq(index);
                            var $next_element = $carousel_elementli.eq(index + 1);

                            if (index == $("#myModalNext .step li").length - 1) {
                                $currstep_element.removeClass("active");
                                $step_elementli.eq(0).addClass("active");

                                $curr_element.removeClass("active");
                                $carousel_elementli.eq(0).addClass("active");
                                return;
                            }

                            $currstep_element.removeClass("active");
                            $nextstep_element.addClass("active");

                            $curr_element.removeClass("active");
                            $next_element.addClass("active");
                        }
                        else if ($(this).hasClass("MN-add")) {
                            $("#myModalNext .carousel").carousel('next');
                            viewload.addNode();
                            $("#myModalNext .step li.active").next().addClass("active");
                        }
                        else if ($(this).hasClass("MN-del")) {
                            viewload.delNode();
                        }
                        else {
                            //$("#myModalNext .carousel").carousel('prev');
                            if ($("#myModalNext .step li").length > 1) {
                                //$($($("#myModalNext .step li.active"))[$("#myModalNext .step li.active").length - 1]).removeClass("active")

                                var index = $("#myModalNext .step li.active").index();
                                console.log(index);
                                var $step_elementli = $("#myModalNext .step li");
                                var $currstep_element = $step_elementli.eq(index);
                                var $prevstep_element = $step_elementli.eq(index - 1);

                                var $carousel_elementli = $(".carousel-inner div.item");
                                var $curr_element = $carousel_elementli.eq(index);
                                var $prev_element = $carousel_elementli.eq(index - 1);

                                var len = $("#myModalNext .step li").length - 1;
                                if (index == 0) {
                                    $currstep_element.removeClass("active");
                                    $step_elementli.eq(len).addClass("active");

                                    $curr_element.removeClass("active");
                                    $carousel_elementli.eq(len).addClass("active");
                                    return;
                                }

                                $currstep_element.removeClass("active");
                                $prevstep_element.addClass("active");

                                $curr_element.removeClass("active");
                                $prev_element.addClass("active");


                            }
                        }
                    })
                })
            }
        }
        }(jQuery))
        viewload.init();
    </script>
</body>
</html>